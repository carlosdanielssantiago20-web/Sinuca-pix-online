<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sinuca Pix Online</title>

<style>
body {
  margin: 0;
  background: radial-gradient(circle at top, #111, #000);
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
  touch-action: none;
}

canvas {
  background: radial-gradient(circle, #0f6b3f, #064026);
  border-radius: 20px;
  box-shadow:
    0 0 40px rgba(0,255,150,0.3),
    inset 0 0 25px rgba(0,0,0,0.8);
}
</style>
</head>

<body>

<canvas id="game" width="360" height="640"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const table = {
  left: 30,
  right: canvas.width - 30,
  top: 30,
  bottom: canvas.height - 30
};

let pointer = {x:0,y:0};
let aiming = false;
let turno = "player";

const cueBall = {
  x: canvas.width / 2,
  y: canvas.height - 140,
  r: 10,
  vx: 0,
  vy: 0,
  color: "#fff"
};

const balls = [cueBall];

function createBalls(){
  const colors = ["#f00","#00f","#ff0","#f0f","#0ff","#fa0"];
  let startX = canvas.width/2 - 55;
  let startY = 120;

  for(let i=0;i<6;i++){
    balls.push({
      x: startX + i*22,
      y: startY,
      r: 10,
      vx: 0,
      vy: 0,
      color: colors[i]
    });
  }
}
createBalls();

// ===== INPUT (MOUSE + TOUCH) =====
function setPointer(e){
  const rect = canvas.getBoundingClientRect();
  const touch = e.touches ? e.touches[0] : e;
  pointer.x = touch.clientX - rect.left;
  pointer.y = touch.clientY - rect.top;
}

canvas.addEventListener("mousedown", e=>{
  if(turno !== "player" || !ballsStopped()) return;
  setPointer(e);
  aiming = true;
});

canvas.addEventListener("mousemove", e=>{
  if(aiming) setPointer(e);
});

canvas.addEventListener("mouseup", ()=>{
  shoot();
});

canvas.addEventListener("touchstart", e=>{
  if(turno !== "player" || !ballsStopped()) return;
  setPointer(e);
  aiming = true;
});

canvas.addEventListener("touchmove", e=>{
  if(aiming) setPointer(e);
});

canvas.addEventListener("touchend", ()=>{
  shoot();
});

function shoot(){
  if(!aiming) return;
  const dx = cueBall.x - pointer.x;
  const dy = cueBall.y - pointer.y;

  let power = Math.min(Math.hypot(dx,dy), 120);
  cueBall.vx = (dx / power) * (power * 0.15);
  cueBall.vy = (dy / power) * (power * 0.15);

  aiming = false;
  turno = "ia";
}

// ===== IA =====
function iaPlay(){
  let target = balls[Math.floor(Math.random()*(balls.length-1))+1];
  const dx = cueBall.x - target.x;
  const dy = cueBall.y - target.y;

  cueBall.vx = dx * 0.08;
  cueBall.vy = dy * 0.08;
}

// ===== UTIL =====
function ballsStopped(){
  return balls.every(b => Math.hypot(b.vx,b.vy) < 0.1);
}

// ===== DRAW =====
function drawBall(b){
  ctx.beginPath();
  ctx.arc(b.x+3, b.y+4, b.r, 0, Math.PI*2);
  ctx.fillStyle = "rgba(0,0,0,0.3)";
  ctx.fill();

  const g = ctx.createRadialGradient(
    b.x-3, b.y-3, b.r*0.3,
    b.x, b.y, b.r
  );
  g.addColorStop(0,"#fff");
  g.addColorStop(0.4,b.color);
  g.addColorStop(1,"#000");

  ctx.beginPath();
  ctx.arc(b.x, b.y, b.r, 0, Math.PI*2);
  ctx.fillStyle = g;
  ctx.fill();
}

// ===== LOOP =====
function update(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  ctx.strokeStyle = "#2b1b0f";
  ctx.lineWidth = 20;
  ctx.strokeRect(
    table.left-10,
    table.top-10,
    table.right-table.left+20,
    table.bottom-table.top+20
  );

  balls.forEach(b=>{
    b.x += b.vx;
    b.y += b.vy;
    b.vx *= 0.98;
    b.vy *= 0.98;

    if(b.x-b.r < table.left || b.x+b.r > table.right) b.vx *= -1;
    if(b.y-b.r < table.top || b.y+b.r > table.bottom) b.vy *= -1;

    drawBall(b);
  });

  if(aiming){
    ctx.setLineDash([8,8]);
    ctx.strokeStyle = "rgba(255,255,255,0.6)";
    ctx.beginPath();
    ctx.moveTo(cueBall.x, cueBall.y);
    ctx.lineTo(pointer.x, pointer.y);
    ctx.stroke();
    ctx.setLineDash([]);
  }

  if(turno === "ia" && ballsStopped()){
    setTimeout(()=>{
      iaPlay();
      turno = "player";
    }, 700);
  }

  requestAnimationFrame(update);
}

update();
</script>

</body>
</html>
