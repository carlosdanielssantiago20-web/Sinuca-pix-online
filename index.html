<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sinuca Pix Online</title>

<style>
body {
  margin: 0;
  background: radial-gradient(circle at top, #111, #000);
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
  touch-action: none;
}

canvas {
  background: radial-gradient(circle, #0f6b3f, #064026);
  border-radius: 20px;
  box-shadow:
    0 0 40px rgba(0,255,150,0.3),
    inset 0 0 25px rgba(0,0,0,0.8);
}
</style>
</head>

<body>
<canvas id="game" width="360" height="640"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const table = { left:30, right:330, top:30, bottom:610 };
let pointer = {x:0,y:0};
let aiming = false;
let turno = "player";

const balls = [];

function createBall(x,y,color){
  return { x,y,r:10,vx:0,vy:0,color };
}

// bola branca
const cueBall = createBall(180,500,"#fff");
balls.push(cueBall);

// bolas coloridas
const colors = ["#f00","#00f","#ff0","#f0f","#0ff","#fa0"];
let sx = 180-55;
for(let i=0;i<6;i++){
  balls.push(createBall(sx+i*22,150,colors[i]));
}

// ===== INPUT =====
function setPointer(e){
  const r = canvas.getBoundingClientRect();
  const t = e.touches ? e.touches[0] : e;
  pointer.x = t.clientX - r.left;
  pointer.y = t.clientY - r.top;
}

canvas.onmousedown = e=>{
  if(turno==="player" && ballsStopped()){ setPointer(e); aiming=true; }
};
canvas.onmousemove = e=>{ if(aiming) setPointer(e); };
canvas.onmouseup = ()=>shoot();

canvas.ontouchstart = e=>{
  if(turno==="player" && ballsStopped()){ setPointer(e); aiming=true; }
};
canvas.ontouchmove = e=>{ if(aiming) setPointer(e); };
canvas.ontouchend = ()=>shoot();

function shoot(){
  if(!aiming) return;
  const dx = cueBall.x - pointer.x;
  const dy = cueBall.y - pointer.y;
  const dist = Math.min(Math.hypot(dx,dy),120);
  cueBall.vx = (dx/dist)*6;
  cueBall.vy = (dy/dist)*6;
  aiming=false;
  turno="ia";
}

// ===== IA =====
function iaPlay(){
  let alvo = null;
  let menorDist = Infinity;

  // escolhe a bola mais próxima
  for(let i=1;i<balls.length;i++){
    const b = balls[i];
    const d = Math.hypot(b.x - cueBall.x, b.y - cueBall.y);
    if(d < menorDist){
      menorDist = d;
      alvo = b;
    }
  }

  if(!alvo) return;

  // direção
  let dx = cueBall.x - alvo.x;
  let dy = cueBall.y - alvo.y;
  let dist = Math.hypot(dx,dy);

  // normaliza
  dx /= dist;
  dy /= dist;

  // força inteligente
  let força = Math.min(dist * 0.03, 5);

  cueBall.vx = dx * força;
  cueBall.vy = dy * força;
}

// ===== FÍSICA =====
function ballsStopped(){
  return balls.every(b=>Math.hypot(b.vx,b.vy)<0.05);
}

function collision(a,b){
  const dx=b.x-a.x, dy=b.y-a.y;
  const dist=Math.hypot(dx,dy);
  if(dist< a.r+b.r){
    const nx=dx/dist, ny=dy/dist;
    const p=2*(a.vx*nx+a.vy*ny-b.vx*nx-b.vy*ny)/2;
    a.vx-=p*nx; a.vy-=p*ny;
    b.vx+=p*nx; b.vy+=p*ny;
  }
}

// ===== DESENHO =====
function drawBall(b){
  ctx.beginPath();
  ctx.arc(b.x,b.y,b.r,0,Math.PI*2);
  ctx.fillStyle=b.color;
  ctx.fill();
}

function update(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  ctx.strokeStyle="#2b1b0f";
  ctx.lineWidth=20;
  ctx.strokeRect(20,20,320,600);

  balls.forEach(b=>{
    b.x+=b.vx; b.y+=b.vy;
    b.vx*=0.98; b.vy*=0.98;

    if(b.x-b.r<table.left||b.x+b.r>table.right) b.vx*=-1;
    if(b.y-b.r<table.top||b.y+b.r>table.bottom) b.vy*=-1;
  });

  for(let i=0;i<balls.length;i++)
    for(let j=i+1;j<balls.length;j++)
      collision(balls[i],balls[j]);

  balls.forEach(drawBall);

  if(aiming){
    ctx.setLineDash([8,8]);
    ctx.strokeStyle="#fff";
    ctx.beginPath();
    ctx.moveTo(cueBall.x,cueBall.y);
    ctx.lineTo(pointer.x,pointer.y);
    ctx.stroke();
    ctx.setLineDash([]);
  }

  if(turno==="ia" && ballsStopped()){
    setTimeout(()=>{ iaPlay(); turno="player"; },700);
  }

  requestAnimationFrame(update);
}
update();
</script>
</body>
</html>
